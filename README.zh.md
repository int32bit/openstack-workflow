[ğŸ‘‰English](./README.md)

# Openstack æ“ä½œåºåˆ—å›¾

æœ¬é¡¹ç›®ä½¿ç”¨[Websequence Diagrams Tool](https://www.websequencediagrams.com/)ç»˜åˆ¶Openstackæ“ä½œåºåˆ—å›¾. é€šè¿‡æ“ä½œåºåˆ—å›¾èƒ½å¤Ÿå¿«é€Ÿè¿½è¸ªOpenstackæºä»£ç ï¼Œå¯¹åˆå­¦è€…å­¦ä¹ Openstackæºç å¾ˆæœ‰å¸®åŠ©ï¼Œä¹Ÿ An easiest way to track the source of Openstack and can be useful for user to learn Openstack or administer to problem troubleshooting. Noted that all these works are based on Openstack Liberty version, it may be changed in the future version, be careful to use if your Openstack version is not Liberty.

## æ“ä½œåˆ—è¡¨

### 1. è™šæ‹Ÿæœºç®¡ç†

- [x] [å¯åŠ¨è™šæ‹Ÿæœº](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/create.png)
- [x] [å¼€æœº](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/start.png)
- [x] [å…³æœº](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/stop.png)
- [x] [é‡å¯](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/reboot.png)
- [x] [é‡å»º](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/rebuild.png)
- [x] [æ‰©å®¹(ä¿®æ”¹Flavoré…ç½®)](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/resize.png)
- [x] [æ‰“å°è™šæ‹Ÿæœºåˆ—è¡¨](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/list.png)
- [x] [åˆ é™¤è™šæ‹Ÿæœº](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/delete.png)
- [x] [é‡ç½®çŠ¶æ€](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/reset_state.png)
- [x] [åˆ›å»ºå¿«ç…§](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/snapshot.png)
- [x] [ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/changePassword.png)
- [x] [ç–æ•£è¿ç§»](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/evacuate.png)
- [x] [åœæ­¢è™šæ‹Ÿæœº](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/pause.png)
- [x] [ä»pauseçš„è™šæ‹Ÿæœºæ¢å¤](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/unpause.png)
- [x] [æŒ‚èµ·è™šæ‹Ÿæœº](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/suspend.png)
- [x] [æ¢å¤è™šæ‹Ÿæœº](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/resume.png)
- [x] [é‡ç½®ç½‘ç»œ](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/reset_network.png)
- [x] [å†·è¿ç§»](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/migrate.png)
- [x] [åœ¨çº¿è¿ç§»](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/live_migrate.png)
- [x] [Shelve](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/shelve.png)
- [x] [Shelve-offload](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/shelve_offload.png)
- [x] [Unshelve](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/unshelve.png)
- [x] [é”å®šè™šæ‹Ÿæœº](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/lock.png)
- [x] [è§£é”è™šæ‹Ÿæœº](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/unlock.png)
- [x] [å®šæ—¶å¤‡ä»½è™šæ‹Ÿæœº](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/backup.png)
- [x] [Refresh Network](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/reset_network.png)
- [x] [é‡å‘½åè™šæ‹Ÿæœº](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/rename.png)
- [x] [æ‹¯æ•‘æ¨¡å¼](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/rescue.png)
- [x] [Unrescue](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/unrescue.png)
- [x] [æŒ‚è½½volume](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/volume_attach.png)
- [x] [å¸è½½volume](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/volume-detach.png)
- [x] [æŒ‚è½½ç½‘å¡](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/interface-attach.png)
- [x] [å¸è½½ç½‘å¡](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/nova/interface-detach.png)


### 2. Todoåˆ—è¡¨

- [ ] Cinder
- [ ] Neutron
- [ ] Sahara

    * - [x] [åˆ›å»ºé›†ç¾¤](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/sahara/create_cluster.png)

![create cluster](https://raw.githubusercontent.com/int32bit/openstack-workflow/master/output/sahara/create_cluster.png)

- [ ] Magnum
- [ ] ...

## å¿«é€Ÿå¼€å§‹


### 1. ç”Ÿæˆå›¾ç‰‡

Before generate the diagrams on your localhost, ensure your machine can access the Internet and the `make` tools hava been correctly installed.

```
make
```

ç”Ÿæˆçš„å›¾ç‰‡é»˜è®¤ä¿å­˜åœ¨`./output`è·¯å¾„ä¸‹.

### 2. æ¸…é™¤å›¾ç‰‡

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ é™¤ç”Ÿæˆçš„å›¾ç‰‡

```
make clean
```


## Demoå®ä¾‹

### 1. åˆ›å»ºè™šæ‹Ÿæœº

![create server workflow](output/nova/create.png)

### 2. é‡å¯è™šæ‹Ÿæœº

 
![reboot server](output/nova/reboot.png)

### 3. å…³æœºè™šæ‹Ÿæœº

![stop server](output/nova/stop.png)

### 4. é‡å»ºè™šæ‹Ÿæœº

![rebuild server](output/nova/rebuild.png)


## éœ€è¦æ›´å¤šçš„æ“ä½œåºåˆ—å›¾?

é˜…è¯»æºä»£ç å¹¶ä½¿ç”¨[Websequence Diagrams Tool](https://www.websequencediagrams.com/)è¯­æ³•ç¼–å†™è„šæœ¬ï¼Œæ¯”å¦‚:

```
title pause a server

participant client
participant nova_api

client->nova_api: pause
activate client
activate nova_api

# nova/api/openstack/compute/pause_server.py _pause()
note over nova_api: authrize context
nova_api->database: get instance by uuid
database->nova_api: done

# nova/compute/api.py pause()
note over nova_api: check policy
note over nova_api: check instance lock
note over nova_api: check instance cell
note over nova_api: ensure instance state is ACTIVE
nova_api->database: task_state = PAUSING
database->nova_api: done

note over nova_api: record pause action
# nova/compute/rpcapi.py pause_instance()
nova_api->nova_compute: pause_instance
deactivate nova_api
deactivate client
activate nova_compute

# nova/compute/manager.py pause_instance()
note over nova_compute: notify: pause.start
nova_compute->libvirt: pause
activate libvirt

# nova/virt/libvirt/driver.py pause()
note over libvirt: get domain
note over libvirt: domain.suspend()
libvirt->nova_compute: done
deactivate libvirt
# nova/compute/manager.py pause_instance()
nova_compute->database: vm_state = vm_states.PAUSED\ntask_state = None
database->nova_compute: done
note over nova_compute: notify: pause.end
deactivate nova_compute
```

## è´¡çŒ®åˆ—è¡¨

ä»¥ä¸‹è¿™äº›äººå‚ä¸äº†è¯¥é¡¹ç›®å¼€å‘:

* AndiaQ
* int32bit
* ljjjustin

æ„Ÿè°¢ä½ ä»¬! (å¦‚æœæˆ‘é—å¿˜äº†ä½ çš„åå­—ï¼Œè¯·è®©æˆ‘çŸ¥é“)

## åè®®

MIT
